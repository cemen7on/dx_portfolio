function parseQueryString(a){"?"==a[0]&&(a=a.substr(1));for(var b,c=a.split(","),d={},e=0,f=c.length;f>e;e++)b=c[e].split("="),b[0]&&b[1]&&(d[b[0]]=b[1]);return d}(function(){var a=this,b=a._,c=Array.prototype,d=Object.prototype,e=Function.prototype,f=c.push,g=c.slice,h=d.toString,i=d.hasOwnProperty,j=Array.isArray,k=Object.keys,l=e.bind,m=function(a){return a instanceof m?a:this instanceof m?void(this._wrapped=a):new m(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=m),exports._=m):a._=m,m.VERSION="1.7.0";var n=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},o=function(a,b,c){return null==a?m.identity:m.isFunction(a)?n(a,b,c):m.isObject(a)?m.matches(a):m.property(a)};m.iteratee=function(a,b){return o(a,b)},m.each=m.forEach=function(a,b,c){if(null==a)return a;b=n(b,c);var d,e=a.length;if(e===+e)for(d=0;e>d;d++)b(a[d],d,a);else{var f=m.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},m.map=m.collect=function(a,b,c){if(null==a)return[];b=o(b,c);for(var d,e=a.length!==+a.length&&m.keys(a),f=(e||a).length,g=Array(f),h=0;f>h;h++)d=e?e[h]:h,g[h]=b(a[d],d,a);return g};var p="Reduce of empty array with no initial value";m.reduce=m.foldl=m.inject=function(a,b,c,d){null==a&&(a=[]),b=n(b,d,4);var e,f=a.length!==+a.length&&m.keys(a),g=(f||a).length,h=0;if(arguments.length<3){if(!g)throw new TypeError(p);c=a[f?f[h++]:h++]}for(;g>h;h++)e=f?f[h]:h,c=b(c,a[e],e,a);return c},m.reduceRight=m.foldr=function(a,b,c,d){null==a&&(a=[]),b=n(b,d,4);var e,f=a.length!==+a.length&&m.keys(a),g=(f||a).length;if(arguments.length<3){if(!g)throw new TypeError(p);c=a[f?f[--g]:--g]}for(;g--;)e=f?f[g]:g,c=b(c,a[e],e,a);return c},m.find=m.detect=function(a,b,c){var d;return d=a.length===+a.length?m.findIndex(a,b,c):m.findKey(a,b,c),void 0!==d&&-1!==d?a[d]:void 0},m.filter=m.select=function(a,b,c){var d=[];return null==a?d:(b=o(b,c),m.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d)},m.reject=function(a,b,c){return m.filter(a,m.negate(o(b)),c)},m.every=m.all=function(a,b,c){if(null==a)return!0;b=o(b,c);var d,e,f=a.length!==+a.length&&m.keys(a),g=(f||a).length;for(d=0;g>d;d++)if(e=f?f[d]:d,!b(a[e],e,a))return!1;return!0},m.some=m.any=function(a,b,c){if(null==a)return!1;b=o(b,c);var d,e,f=a.length!==+a.length&&m.keys(a),g=(f||a).length;for(d=0;g>d;d++)if(e=f?f[d]:d,b(a[e],e,a))return!0;return!1},m.contains=m.include=function(a,b){return null==a?!1:(a.length!==+a.length&&(a=m.values(a)),m.indexOf(a,b)>=0)},m.invoke=function(a,b){var c=g.call(arguments,2),d=m.isFunction(b);return m.map(a,function(a){return(d?b:a[b]).apply(a,c)})},m.pluck=function(a,b){return m.map(a,m.property(b))},m.where=function(a,b){return m.filter(a,m.matches(b))},m.findWhere=function(a,b){return m.find(a,m.matches(b))},m.max=function(a,b,c){var d,e,f=-1/0,g=-1/0;if(null==b&&null!=a){a=a.length===+a.length?a:m.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=o(b,c),m.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-1/0&&f===-1/0)&&(f=a,g=e)});return f},m.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=a.length===+a.length?a:m.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=o(b,c),m.each(a,function(a,c,d){e=b(a,c,d),(g>e||1/0===e&&1/0===f)&&(f=a,g=e)});return f},m.shuffle=function(a){for(var b,c=a&&a.length===+a.length?a:m.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=m.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},m.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=m.values(a)),a[m.random(a.length-1)]):m.shuffle(a).slice(0,Math.max(0,b))},m.sortBy=function(a,b,c){return b=o(b,c),m.pluck(m.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var q=function(a){return function(b,c,d){var e={};return c=o(c,d),m.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};m.groupBy=q(function(a,b,c){m.has(a,c)?a[c].push(b):a[c]=[b]}),m.indexBy=q(function(a,b,c){a[c]=b}),m.countBy=q(function(a,b,c){m.has(a,c)?a[c]++:a[c]=1}),m.sortedIndex=function(a,b,c,d){c=o(c,d,1);for(var e=c(b),f=0,g=a.length;g>f;){var h=f+g>>>1;c(a[h])<e?f=h+1:g=h}return f},m.toArray=function(a){return a?m.isArray(a)?g.call(a):a.length===+a.length?m.map(a,m.identity):m.values(a):[]},m.size=function(a){return null==a?0:a.length===+a.length?a.length:m.keys(a).length},m.partition=function(a,b,c){b=o(b,c);var d=[],e=[];return m.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},m.first=m.head=m.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:m.initial(a,a.length-b)},m.initial=function(a,b,c){return g.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},m.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:m.rest(a,Math.max(0,a.length-b))},m.rest=m.tail=m.drop=function(a,b,c){return g.call(a,null==b||c?1:b)},m.compact=function(a){return m.filter(a,m.identity)};var r=function(a,b,c,d){for(var e,f=[],g=0,h=d||0,i=a&&a.length;i>h;h++)if(e=a[h],e&&e.length>=0&&(m.isArray(e)||m.isArguments(e))){b||(e=r(e,b,c));var j=0,k=e.length;for(f.length+=k;k>j;)f[g++]=e[j++]}else c||(f[g++]=e);return f};m.flatten=function(a,b){return r(a,b,!1)},m.without=function(a){return m.difference(a,g.call(arguments,1))},m.uniq=m.unique=function(a,b,c,d){if(null==a)return[];m.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=o(c,d));for(var e=[],f=[],g=0,h=a.length;h>g;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?m.contains(f,j)||(f.push(j),e.push(i)):m.contains(e,i)||e.push(i)}return e},m.union=function(){return m.uniq(r(arguments,!0,!0))},m.intersection=function(a){if(null==a)return[];for(var b=[],c=arguments.length,d=0,e=a.length;e>d;d++){var f=a[d];if(!m.contains(b,f)){for(var g=1;c>g&&m.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},m.difference=function(a){var b=r(arguments,!0,!0,1);return m.filter(a,function(a){return!m.contains(b,a)})},m.zip=function(a){if(null==a)return[];for(var b=m.max(arguments,"length").length,c=Array(b);b-->0;)c[b]=m.pluck(arguments,b);return c},m.unzip=function(a){return m.zip.apply(null,a)},m.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},m.indexOf=function(a,b,c){var d=0,e=a&&a.length;if("number"==typeof c)d=0>c?Math.max(0,e+c):c;else if(c)return d=m.sortedIndex(a,b),a[d]===b?d:-1;for(;e>d;d++)if(a[d]===b)return d;return-1},m.lastIndexOf=function(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=0>c?d+c+1:Math.min(d,c+1));--d>=0;)if(a[d]===b)return d;return-1},m.findIndex=function(a,b,c){b=o(b,c);for(var d=null!=a?a.length:0,e=0;d>e;e++)if(b(a[e],e,a))return e;return-1},m.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var s=function(){},t=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);s.prototype=a.prototype;var f=new s;s.prototype=null;var g=a.apply(f,e);return m.isObject(g)?g:f};m.bind=function(a,b){if(l&&a.bind===l)return l.apply(a,g.call(arguments,1));if(!m.isFunction(a))throw TypeError("Bind must be called on a function");var c=g.call(arguments,2);return function d(){return t(a,d,b,this,c.concat(g.call(arguments)))}},m.partial=function(a){var b=g.call(arguments,1);return function c(){for(var d=0,e=b.slice(),f=0,g=e.length;g>f;f++)e[f]===m&&(e[f]=arguments[d++]);for(;d<arguments.length;)e.push(arguments[d++]);return t(a,c,this,this,e)}},m.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=m.bind(a[c],a);return a},m.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return m.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},m.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},m.defer=function(a){return m.delay.apply(m,[a,1].concat(g.call(arguments,1)))},m.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:m.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=m.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},m.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=m.now()-g;b>j&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=m.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},m.wrap=function(a,b){return m.partial(b,a)},m.negate=function(a){return function(){return!a.apply(this,arguments)}},m.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},m.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},m.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),1>=a&&(b=null),c}},m.once=m.partial(m.before,2);var u=!{toString:null}.propertyIsEnumerable("toString"),v=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];m.keys=function(a){if(!m.isObject(a))return[];if(k)return k(a);var b=[];for(var c in a)m.has(a,c)&&b.push(c);if(u)for(var d=v.length;d--;){var e=v[d];m.has(a,e)&&!m.contains(b,e)&&b.push(e)}return b},m.values=function(a){for(var b=m.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},m.pairs=function(a){for(var b=m.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},m.invert=function(a){for(var b={},c=m.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},m.functions=m.methods=function(a){var b=[];for(var c in a)m.isFunction(a[c])&&b.push(c);return b.sort()},m.extend=function(a){if(!m.isObject(a))return a;for(var b,c,d=1,e=arguments.length;e>d;d++){b=arguments[d];for(c in b)a[c]=b[c]}return a},m.findKey=function(a,b,c){b=o(b,c);for(var d,e=m.keys(a),f=0,g=e.length;g>f;f++)if(d=e[f],b(a[d],d,a))return d},m.pick=function(a,b,c){var d,e={};if(null==a)return e;if(m.isFunction(b)){b=n(b,c);for(d in a){var f=a[d];b(f,d,a)&&(e[d]=f)}}else{var g=r(arguments,!1,!1,1);a=new Object(a);for(var h=0,i=g.length;i>h;h++)d=g[h],d in a&&(e[d]=a[d])}return e},m.omit=function(a,b,c){if(m.isFunction(b))b=m.negate(b);else{var d=m.map(r(arguments,!1,!1,1),String);b=function(a,b){return!m.contains(d,b)}}return m.pick(a,b,c)},m.defaults=function(a){if(!m.isObject(a))return a;for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];for(var e in d)void 0===a[e]&&(a[e]=d[e])}return a},m.clone=function(a){return m.isObject(a)?m.isArray(a)?a.slice():m.extend({},a):a},m.tap=function(a,b){return b(a),a};var w=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof m&&(a=a._wrapped),b instanceof m&&(b=b._wrapped);var e=h.call(a);if(e!==h.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,i=b.constructor;if(g!==i&&!(m.isFunction(g)&&g instanceof g&&m.isFunction(i)&&i instanceof i)&&"constructor"in a&&"constructor"in b)return!1}for(var j=c.length;j--;)if(c[j]===a)return d[j]===b;c.push(a),d.push(b);var k,l;if(f){if(k=a.length,l=k===b.length)for(;k--&&(l=w(a[k],b[k],c,d)););}else{var n,o=m.keys(a);if(k=o.length,l=m.keys(b).length===k)for(;k--&&(n=o[k],l=m.has(b,n)&&w(a[n],b[n],c,d)););}return c.pop(),d.pop(),l};m.isEqual=function(a,b){return w(a,b,[],[])},m.isEmpty=function(a){if(null==a)return!0;if(m.isArray(a)||m.isString(a)||m.isArguments(a))return 0===a.length;for(var b in a)if(m.has(a,b))return!1;return!0},m.isElement=function(a){return!(!a||1!==a.nodeType)},m.isArray=j||function(a){return"[object Array]"===h.call(a)},m.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},m.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){m["is"+a]=function(b){return h.call(b)==="[object "+a+"]"}}),m.isArguments(arguments)||(m.isArguments=function(a){return m.has(a,"callee")}),"function"!=typeof/./&&(m.isFunction=function(a){return"function"==typeof a||!1}),m.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},m.isNaN=function(a){return m.isNumber(a)&&a!==+a},m.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===h.call(a)},m.isNull=function(a){return null===a},m.isUndefined=function(a){return void 0===a},m.has=function(a,b){return null!=a&&i.call(a,b)},m.noConflict=function(){return a._=b,this},m.identity=function(a){return a},m.constant=function(a){return function(){return a}},m.noop=function(){},m.property=function(a){return function(b){return null==b?void 0:b[a]}},m.matches=function(a){var b=m.pairs(a),c=b.length;return function(a){if(null==a)return!c;a=new Object(a);for(var d=0;c>d;d++){var e=b[d],f=e[0];if(e[1]!==a[f]||!(f in a))return!1}return!0}},m.times=function(a,b,c){var d=Array(Math.max(0,a));b=n(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},m.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},m.now=Date.now||function(){return(new Date).getTime()};var x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},y=m.invert(x),z=function(a){var b=function(b){return a[b]},c="(?:"+m.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};m.escape=z(x),m.unescape=z(y),m.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),m.isFunction(d)?d.call(a):d};var A=0;m.uniqueId=function(a){var b=++A+"";return a?a+b:b},m.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var B=/(.)^/,C={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\u2028|\u2029/g,E=function(a){return"\\"+C[a]};m.template=function(a,b,c){!b&&c&&(b=c),b=m.defaults({},b,m.templateSettings);var d=RegExp([(b.escape||B).source,(b.interpolate||B).source,(b.evaluate||B).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(D,E),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,m)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},m.chain=function(a){var b=m(a);return b._chain=!0,b};var F=function(a,b){return a._chain?m(b).chain():b};m.mixin=function(a){m.each(m.functions(a),function(b){var c=m[b]=a[b];m.prototype[b]=function(){var a=[this._wrapped];return f.apply(a,arguments),F(this,c.apply(m,a))}})},m.mixin(m),m.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=c[a];m.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],F(this,c)}}),m.each(["concat","join","slice"],function(a){var b=c[a];m.prototype[a]=function(){return F(this,b.apply(this._wrapped,arguments))}}),m.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return m})}).call(this),function(a,b){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(c,d,e){a.Backbone=b(a,e,c,d)});else if("undefined"!=typeof exports){var c=require("underscore");b(a,exports,c)}else a.Backbone=b(a,{},a._,a.jQuery||a.Zepto||a.ender||a.$)}(this,function(a,b,c,d){var e=a.Backbone,f=[],g=f.slice;b.VERSION="1.1.2",b.$=d,b.noConflict=function(){return a.Backbone=e,this},b.emulateHTTP=!1,b.emulateJSON=!1;var h=b.Events={on:function(a,b,c){if(!j(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,d){if(!j(this,"once",a,[b,d])||!b)return this;var e=this,f=c.once(function(){e.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(a,f,d)},off:function(a,b,d){if(!this._events||!j(this,"off",a,[b,d]))return this;if(!a&&!b&&!d)return this._events=void 0,this;for(var e=a?[a]:c.keys(this._events),f=0,g=e.length;g>f;f++){a=e[f];var h=this._events[a];if(h)if(b||d){for(var i=[],k=0,l=h.length;l>k;k++){var m=h[k];(b&&b!==m.callback&&b!==m.callback._callback||d&&d!==m.context)&&i.push(m)}i.length?this._events[a]=i:delete this._events[a]}else delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=g.call(arguments,1);if(!j(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&k(c,b),d&&k(d,arguments),this},listenTo:function(a,b,d){var e=this._listeningTo||(this._listeningTo={}),f=a._listenId||(a._listenId=c.uniqueId("l"));return e[f]=a,d||"object"!=typeof b||(d=this),a.on(b,d,this),this},listenToOnce:function(a,b,d){if("object"==typeof b){for(var e in b)this.listenToOnce(a,e,b[e]);return this}var f=c.once(function(){this.stopListening(a,b,f),d.apply(this,arguments)});return f._callback=d,this.listenTo(a,b,f)},stopListening:function(a,b,d){var e=this._listeningTo;if(!e)return this;var f=!b&&!d;d||"object"!=typeof b||(d=this),a&&((e={})[a._listenId]=a);for(var g in e)a=e[g],a.off(b,d,this),(f||c.isEmpty(a._events))&&delete this._listeningTo[g];return this}},i=/\s+/,j=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(i.test(c)){for(var f=c.split(i),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},k=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}};h.bind=h.on,h.unbind=h.off,c.extend(b,h);var l=b.Model=function(a,b){var d=a||{};b||(b={}),this.cid=c.uniqueId("c"),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{}),d=c.defaults({},d,c.result(this,"defaults")),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)};c.extend(l.prototype,h,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return c.clone(this.attributes)},sync:function(){return b.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,d){var e,f,g,h,i,j,k,l;if(null==a)return this;if("object"==typeof a?(f=a,d=b):(f={})[a]=b,d||(d={}),!this._validate(f,d))return!1;g=d.unset,i=d.silent,h=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=c.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in f&&(this.id=f[this.idAttribute]);for(e in f)b=f[e],c.isEqual(l[e],b)||h.push(e),c.isEqual(k[e],b)?delete this.changed[e]:this.changed[e]=b,g?delete l[e]:l[e]=b;if(!i){h.length&&(this._pending=d);for(var m=0,n=h.length;n>m;m++)this.trigger("change:"+h[m],this,l[h[m]],d)}if(j)return this;if(!i)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,c.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var d in this.attributes)b[d]=void 0;return this.set(b,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!c.isEmpty(this.changed):c.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.clone(this.changed):!1;var b,d=!1,e=this._changing?this._previousAttributes:this.attributes;for(var f in a)c.isEqual(e[f],b=a[f])||((d||(d={}))[f]=b);return d},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,d=a.success;return a.success=function(c){return b.set(b.parse(c,a),a)?(d&&d(b,c,a),void b.trigger("sync",b,c,a)):!1},H(this,a),this.sync("read",this,a)},save:function(a,b,d){var e,f,g,h=this.attributes;if(null==a||"object"==typeof a?(e=a,d=b):(e={})[a]=b,d=c.extend({validate:!0},d),e&&!d.wait){if(!this.set(e,d))return!1}else if(!this._validate(e,d))return!1;e&&d.wait&&(this.attributes=c.extend({},h,e)),void 0===d.parse&&(d.parse=!0);var i=this,j=d.success;return d.success=function(a){i.attributes=h;var b=i.parse(a,d);return d.wait&&(b=c.extend(e||{},b)),c.isObject(b)&&!i.set(b,d)?!1:(j&&j(i,a,d),void i.trigger("sync",i,a,d))},H(this,d),f=this.isNew()?"create":d.patch?"patch":"update","patch"!==f||d.attrs||(d.attrs=e),g=this.sync(f,this,d),e&&d.wait&&(this.attributes=h),g},destroy:function(a){a=a?c.clone(a):{};var b=this,d=a.success,e=function(){b.stopListening(),b.trigger("destroy",b,b.collection,a)};if(a.success=function(c){(a.wait||b.isNew())&&e(),d&&d(b,c,a),b.isNew()||b.trigger("sync",b,c,a)},this.isNew())return a.success(),!1;H(this,a);var f=this.sync("delete",this,a);return a.wait||e(),f},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||G();return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},c.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=c.extend({},this.attributes,a);var d=this.validationError=this.validate(a,b)||null;return d?(this.trigger("invalid",this,d,c.extend(b,{validationError:d})),!1):!0}});var m=["keys","values","pairs","invert","pick","omit","chain","isEmpty"];c.each(m,function(a){c[a]&&(l.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.attributes),c[a].apply(c,b)})});var n=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,c.extend({silent:!0},b))},o={add:!0,remove:!0,merge:!0},p={add:!0,remove:!1};c.extend(n.prototype,h,{model:l,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,c.extend({merge:!1},b,p))},remove:function(a,b){var d=!c.isArray(a);a=d?[a]:c.clone(a),b||(b={});for(var e=0,f=a.length;f>e;e++){var g=a[e]=this.get(a[e]);if(g){var h=this.modelId(g.attributes);null!=h&&delete this._byId[h],delete this._byId[g.cid];var i=this.indexOf(g);this.models.splice(i,1),this.length--,b.silent||(b.index=i,g.trigger("remove",g,this,b)),this._removeReference(g,b)}}return d?a[0]:a},set:function(a,b){b=c.defaults({},b,o),b.parse&&(a=this.parse(a,b));var d=!c.isArray(a);a=d?a?[a]:[]:a.slice();for(var e,f,g,h,i,j=b.at,k=this.comparator&&null==j&&b.sort!==!1,l=c.isString(this.comparator)?this.comparator:null,m=[],n=[],p={},q=b.add,r=b.merge,s=b.remove,t=!k&&q&&s?[]:!1,u=0,v=a.length;v>u;u++){if(g=a[u],h=this.get(g))s&&(p[h.cid]=!0),r&&g!==h&&(g=this._isModel(g)?g.attributes:g,b.parse&&(g=h.parse(g,b)),h.set(g,b),k&&!i&&h.hasChanged(l)&&(i=!0)),a[u]=h;else if(q){if(f=a[u]=this._prepareModel(g,b),!f)continue;m.push(f),this._addReference(f,b)}f=h||f,f&&(e=this.modelId(f.attributes),!t||!f.isNew()&&p[e]||t.push(f),p[e]=!0)}if(s){for(var u=0,v=this.length;v>u;u++)p[(f=this.models[u]).cid]||n.push(f);n.length&&this.remove(n,b)}if(m.length||t&&t.length)if(k&&(i=!0),this.length+=m.length,null!=j)for(var u=0,v=m.length;v>u;u++)this.models.splice(j+u,0,m[u]);else{t&&(this.models.length=0);for(var w=t||m,u=0,v=w.length;v>u;u++)this.models.push(w[u])}if(i&&this.sort({silent:!0}),!b.silent){for(var x=null!=j?c.clone(b):b,u=0,v=m.length;v>u;u++)null!=j&&(x.index=j+u),(f=m[u]).trigger("add",f,this,x);(i||t&&t.length)&&this.trigger("sort",this,b)}return d?a[0]:a},reset:function(a,b){b=b?c.clone(b):{};for(var d=0,e=this.models.length;e>d;d++)this._removeReference(this.models[d],b);return b.previousModels=this.models,this._reset(),a=this.add(a,c.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,c.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return this.add(a,c.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(){return g.apply(this.models,arguments)},get:function(a){if(null==a)return void 0;var b=this.modelId(this._isModel(a)?a.attributes:a);return this._byId[a]||this._byId[b]||this._byId[a.cid]},at:function(a){return 0>a&&(a+=this.length),this.models[a]},where:function(a,b){return c.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),c.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(c.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return c.invoke(this.models,"get",a)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,d=this;return a.success=function(c){var e=a.reset?"reset":"set";d[e](c,a),b&&b(d,c,a),d.trigger("sync",d,c,a)},H(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?c.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var d=this,e=b.success;return b.success=function(a,c){b.wait&&d.add(a,b),e&&e(a,c,b)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(a){return a[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(this._isModel(a))return a.collection||(a.collection=this),a;b=b?c.clone(b):{},b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},_isModel:function(a){return a instanceof l},_addReference:function(a){this._byId[a.cid]=a;var b=this.modelId(a.attributes);null!=b&&(this._byId[b]=a),a.on("all",this._onModelEvent,this)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if("add"!==a&&"remove"!==a||c===this){if("destroy"===a&&this.remove(b,d),"change"===a){var e=this.modelId(b.previousAttributes()),f=this.modelId(b.attributes);e!==f&&(null!=e&&delete this._byId[e],null!=f&&(this._byId[f]=b))}this.trigger.apply(this,arguments)}}});var q=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample","partition"];c.each(q,function(a){c[a]&&(n.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.models),c[a].apply(c,b)})});var r=["groupBy","countBy","sortBy","indexBy"];c.each(r,function(a){c[a]&&(n.prototype[a]=function(b,d){var e=c.isFunction(b)?b:function(a){return a.get(b)};return c[a](this.models,e,d)})});var s=b.View=function(a){this.cid=c.uniqueId("view"),a||(a={}),c.extend(this,c.pick(a,u)),this._ensureElement(),this.initialize.apply(this,arguments)},t=/^(\S+)\s*(.*)$/,u=["model","collection","el","id","attributes","className","tagName","events"];c.extend(s.prototype,h,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(a){return this.undelegateEvents(),this._setElement(a),this.delegateEvents(),this},_setElement:function(a){this.$el=a instanceof b.$?a:b.$(a),this.el=this.$el[0]},delegateEvents:function(a){if(!a&&!(a=c.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var d=a[b];if(c.isFunction(d)||(d=this[a[b]]),d){var e=b.match(t);this.delegate(e[1],e[2],c.bind(d,this))}}return this},delegate:function(a,b,c){this.$el.on(a+".delegateEvents"+this.cid,b,c)},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(a,b,c){this.$el.off(a+".delegateEvents"+this.cid,b,c)},_createElement:function(a){return document.createElement(a)},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"));else{var a=c.extend({},c.result(this,"attributes"));this.id&&(a.id=c.result(this,"id")),this.className&&(a["class"]=c.result(this,"className")),this.setElement(this._createElement(c.result(this,"tagName"))),this._setAttributes(a)}},_setAttributes:function(a){this.$el.attr(a)}}),b.sync=function(a,d,e){var f=v[a];c.defaults(e||(e={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var g={type:f,dataType:"json"};if(e.url||(g.url=c.result(d,"url")||G()),null!=e.data||!d||"create"!==a&&"update"!==a&&"patch"!==a||(g.contentType="application/json",g.data=JSON.stringify(e.attrs||d.toJSON(e))),e.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),e.emulateHTTP&&("PUT"===f||"DELETE"===f||"PATCH"===f)){g.type="POST",e.emulateJSON&&(g.data._method=f);var h=e.beforeSend;e.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",f),h?h.apply(this,arguments):void 0}}"GET"===g.type||e.emulateJSON||(g.processData=!1);var i=e.error;e.error=function(a,b,c){e.textStatus=b,e.errorThrown=c,i&&i.apply(this,arguments)};var j=e.xhr=b.ajax(c.extend(g,e));return d.trigger("request",d,j,e),j};var v={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var w=b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},x=/\((.*?)\)/g,y=/(\(\?)?:\w+/g,z=/\*\w+/g,A=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(w.prototype,h,{initialize:function(){},route:function(a,d,e){c.isRegExp(a)||(a=this._routeToRegExp(a)),c.isFunction(d)&&(e=d,d=""),e||(e=this[d]);var f=this;return b.history.route(a,function(c){var g=f._extractParameters(a,c);f.execute(e,g,d)!==!1&&(f.trigger.apply(f,["route:"+d].concat(g)),f.trigger("route",d,g),b.history.trigger("route",f,d,g))}),this},execute:function(a,b){a&&a.apply(this,b)},navigate:function(a,c){return b.history.navigate(a,c),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(A,"\\$&").replace(x,"(?:$1)?").replace(y,function(a,b){return b?a:"([^/?]+)"}).replace(z,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")
},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return c.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}});var B=b.History=function(){this.handlers=[],c.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},C=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,E=/#.*$/;B.started=!1,c.extend(B.prototype,h,{interval:50,atRoot:function(){var a=this.location.pathname.replace(/[^\/]$/,"$&/");return a===this.root&&!this.getSearch()},getSearch:function(){var a=this.location.href.replace(/#.*/,"").match(/\?.+/);return a?a[0]:""},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getPath:function(){var a=decodeURI(this.location.pathname+this.getSearch()),b=this.root.slice(0,-1);return a.indexOf(b)||(a=a.slice(b.length)),a.slice(1)},getFragment:function(a){return null==a&&(a=this._hasPushState||!this._wantsHashChange?this.getPath():this.getHash()),a.replace(C,"")},start:function(a){if(B.started)throw new Error("Backbone.history has already been started");B.started=!0,this.options=c.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState),this.fragment=this.getFragment();var b=window.addEventListener||function(a,b){return attachEvent("on"+a,b)};if(this.root=("/"+this.root+"/").replace(D,"/"),!(this._hasHashChange||!this._wantsHashChange||this._wantsPushState&&this._hasPushState)){var d=document.createElement("iframe");d.src="javascript:0",d.style.display="none",d.tabIndex=-1;var e=document.body;this.iframe=e.insertBefore(d,e.firstChild).contentWindow,this.navigate(this.fragment)}if(this._hasPushState?b("popstate",this.checkUrl,!1):this._wantsHashChange&&this._hasHashChange&&!this.iframe?b("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.location.replace(this.root+"#"+this.getPath()),!0;this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}return this.options.silent?void 0:this.loadUrl()},stop:function(){var a=window.removeEventListener||function(a,b){return detachEvent("on"+a,b)};this._hasPushState?a("popstate",this.checkUrl,!1):this._wantsHashChange&&this._hasHashChange&&!this.iframe&&a("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe.frameElement),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),B.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getHash(this.iframe)),a===this.fragment?!1:(this.iframe&&this.navigate(a),void this.loadUrl())},loadUrl:function(a){return a=this.fragment=this.getFragment(a),c.any(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})},navigate:function(a,b){if(!B.started)return!1;b&&b!==!0||(b={trigger:!!b}),a=this.getFragment(a||"");var c=this.root;(""===a||"?"===a.charAt(0))&&(c=c.slice(0,-1)||"/");var d=c+a;if(a=decodeURI(a.replace(E,"")),this.fragment!==a){if(this.fragment=a,this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,d);else{if(!this._wantsHashChange)return this.location.assign(d);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getHash(this.iframe)&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),b.history=new B;var F=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};l.extend=n.extend=w.extend=s.extend=B.extend=F;var G=function(){throw new Error('A "url" property or function must be specified')},H=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}};return b}),Object.isJquery=function(a){return a instanceof jQuery},Object.getType=function(a){return String(typeof a).toLowerCase()},Object.isset=function(a){return!this.isNull(a)&&!this.isUndefined(a)},Object.isNull=function(a){return null===a},Object.isUndefined=function(a){return void 0===a},Object.isObject=function(a){return!this.isNull(a)&&"object"==this.getType(a)},Object.isString=function(a){return"string"==this.getType(a)},Object.isNumber=function(a){return!isNaN(a)},Object.isFunction=function(a){return"function"==this.getType(a)},String.prototype.firstToUpper=function(){var a=this.charAt(0).toUpperCase();return a+this.substr(1,this.length-1)};var NO_INITIALIZE=1;!function(){var a=["Model","Collection","Router","View","History"],b=function(b){for(var c=0,d=a.length;d>c;c++)if(b instanceof Backbone[a[c]])return Backbone[a[c]];return null},c=function(b){for(var c=0,d=a.length;d>c;c++)if(b===Backbone[a[c]])return!0;return!1},d=function(a){var d,e=this;a=a||{},d=function(a){if(a!==NO_INITIALIZE){Object.defineProperty(this,"__super__",{configurable:!1,enumerable:!1,writable:!1,value:Object.getPrototypeOf(this)});var c=b(this);return c.apply(this,arguments)}return Object.getPrototypeOf(this)};var f;f=c(e)?e.prototype:new e(NO_INITIALIZE);var g=function(){};return g.prototype=f,d.prototype=new g,_.extend(d.prototype,a),_.extend(d,e),d},e=function(a){var d,e=this;a=a||function(){},d=function(c){if(a.call(this),Object.defineProperty(this,"__super__",{configurable:!1,enumerable:!1,writable:!1,value:Object.getPrototypeOf(this)}),c!==NO_INITIALIZE){var d=b(this);d.apply(this,arguments)}};var f;return f=c(e)?e.prototype:new e(NO_INITIALIZE),d.prototype=f,_.extend(d,e),d},f=function(a){return Object.isFunction(a)?e.call(this,a):d.call(this,a)};Backbone.Model.extend=Backbone.Collection.extend=Backbone.Router.extend=Backbone.View.extend=Backbone.History.extend=f}();var Core=new function(){this.use=function(a){var b=Array.isArray(a)?a:a.split("."),c={};if(!b.length)return c;var d=function(a,b){return a.hasOwnProperty(b)||(a[b]={}),a[b]};c=d(window,b.shift());for(var e=0,f=b.length;f>e;e++)c=d(c,b[e]);return c},this.createAbsoluteUrl=function(a){return a=a||"",location.origin+("/"!=a[0]?"/":"")+a}},use=Core.use;use("Core").Collection=Backbone.Collection.extend(function(){var a={add:!0,remove:!0,merge:!0};this.set=function(b,c){c=_.defaults({},c,a),c.parse&&(b=this.parse(b,c)),c.parse=!1;var d=!_.isArray(b);b=d?b?[b]:[]:b.slice();for(var e,f,g,h,i,j=c.at,k=this.comparator&&null==j&&c.sort!==!1,l=_.isString(this.comparator)?this.comparator:null,m=[],n=[],o={},p=c.add,q=c.merge,r=c.remove,s=!k&&p&&r?[]:!1,t=0,u=b.length;u>t;t++){if(g=b[t],h=this.get(g))r&&(o[h.cid]=!0),q&&g!==h&&(g=this._isModel(g)?g.attributes:g,c.parse&&(g=h.parse(g,c)),h.set(g,c),k&&!i&&h.hasChanged(l)&&(i=!0)),b[t]=h;else if(p){if(f=b[t]=this._prepareModel(g,c),!f)continue;m.push(f),this._addReference(f,c)}f=h||f,f&&(e=this.modelId(f.attributes),!s||!f.isNew()&&o[e]||s.push(f),o[e]=!0)}if(r){for(var t=0,u=this.length;u>t;t++)o[(f=this.models[t]).cid]||n.push(f);n.length&&this.remove(n,c)}if(m.length||s&&s.length)if(k&&(i=!0),this.length+=m.length,null!=j)for(var t=0,u=m.length;u>t;t++)this.models.splice(j+t,0,m[t]);else{s&&(this.models.length=0);for(var v=s||m,t=0,u=v.length;u>t;t++)this.models.push(v[t])}if(i&&this.sort({silent:!0}),!c.silent){for(var w=null!=j?_.clone(c):c,t=0,u=m.length;u>t;t++)null!=j&&(w.index=j+t),(f=m[t]).trigger("add",f,this,w);(i||s&&s.length)&&this.trigger("sort",this,c)}return d?b[0]:b},this.fetch=function(a){a=a||{};var b=this;return new Core.Promise(function(c,d){var e,f;b.isEmpty()?(e=a.success||function(){},f=a.error||function(){},a.success=function(){e.apply(this,arguments),c()},a.error=function(a,b,c){var e;try{e=JSON.parse(a.responseText)}catch(g){e=a.responseText}f(e,a.status,c),d(e,a.status,c)},Backbone.Collection.prototype.fetch.call(b,a)):c()})}}),use("Core").Controller=new function(){var a=function(a){a.blur=a.blur||function(){}};this.extend=function(b){return b=b||{},a(b),b}},use("Core").HTTPRequest=function(a,b,c,d){return b=b||"GET",c=c||{},d=d||"json",new Core.Promise(function(e,f){$.ajax({url:a,type:b,data:c,dataType:d,success:function(a){return a&&a.success?void e(a.success):void f({message:"No response was received",code:0})},error:function(a,b,c){var d;try{d=JSON.parse(a.responseText)}catch(e){d=a.responseText}f(d,a.status,c)}})})},use("Core").Model=Backbone.Model.extend(function(){this.fetch=function(a){a=a||{};var b=this;return new Core.Promise(function(c,d){var e,f;b.isEmpty()?(e=a.success||function(){},f=a.error||function(){},a.success=function(){e.apply(this,arguments),c()},a.error=function(a,b,c){var e;try{e=JSON.parse(a.responseText)}catch(g){e=a.responseText}f(e,a.status,c),d(e,a.status,c)},Backbone.Model.prototype.fetch.call(b,a)):c()})}}),use("Core").Promise=function(a){var b=!1,c=!1,d=[],e=function(){b=!0;for(var a=0,c=d.length;c>a;a++)d[a].apply(null,arguments)},f=[],g=function(){c=!0;for(var a=0,b=f.length;b>a;a++)f[a].apply(null,arguments)},h=function(a){return"function"==String(typeof a).toLowerCase()},i=function(a,b,c){b=b||[],c=c||window,setTimeout(function(){a.apply(c,b)},0)};this.then=function(a,e){h(a)&&(b?i(a):d.push(a)),h(e)&&(c?i(e):f.push(e))},i(a,[e,g])},use("Core").Reflection=function(a){var b=null,c=function(a){if(!Object.isString(a))throw new Error("Invalid argument type: name must be a string");for(var c=a.split("."),d=window,e=0,f=c.length;f>e;e++){if(!Object.isObject(d)||!d[c[e]])return;d=d[c[e]]}b=d};return this.get=function(){return b},this.has=function(){return Boolean(b)},function(a){c(a)}(a),this},use("Core").Region=function(a){var b=null,c=null;Object.defineProperty(this,"el",{set:function(a){if(a instanceof HTMLElement)return void(c=a);if(Object.isString(a))return void(c=document.querySelector(a));throw new Error("Invalid argument type: Region.el must be either valid selector or HTMLElement")},get:function(){return c}}),this.display=function(a){return b&&b.remove(),b=a,a.trigger("display"),a.display?a.display(this):null},this.empty=function(){return b&&(b.remove(),b=null),this},this.append=function(a){return a.el?(this.el.appendChild(a.el),!0):this},this.el=a},use("Core").View=Backbone.View.extend(function(){this.delegate=function(a,b,c){var d=this;this.$el.on(a+".delegateEvents"+this.cid,b,function(a){c(a,d)})}}),_.extend(Core.View,Backbone.Events),Core.ViewCollection=Core.View.extend(function(){this.view=null,this.initialize=function(){this.Views=[],this.fillCollection()},this.createViewInstance=function(a){return new this.view({model:a})},this.addView=function(a){return this.Views.push(a),this},this.fillCollection=function(){for(var a=0,b=this.collection.length;b>a;a++)this.addView(this.createViewInstance(this.collection.models[a]));return this},this.remove=function(){for(var a=0,b=this.Views.length;b>a;a++)this.Views[a].remove();return this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el),this}}),Core.ViewLayout=Backbone.View.extend(),Core.ViewLayout.extend=function(a){return new(Backbone.View.extend.call(this,a))};var App=new function(){var a=this,b=!1;Object.defineProperty(a,"Router",{configurable:!0,get:function(){return null},set:function(b){if(!b instanceof Backbone.Router)throw new Error("Invalid argument type: Router must be Backbone.Router instance");Object.defineProperty(a,"Router",{writable:!1,value:b})}});var c=null;Object.defineProperty(a,"Controller",{get:function(){return c}});var d=function(a){var b={behalf:window,method:a};if(!Object.isString(a)||!a.length)return b;var c,d,e=a.split(".");return 1==e.length?(b.method=e[0],b):(c=e.pop(),d=new Core.Reflection(e.join(".")).get(),d&&Object.isFunction(d[c])?(b.behalf=d,b.method=d[c],b):b)};a.run=function(e,f){if(b)throw new Error("Application has already been run");f=f||null,a.Router=new(Backbone.Router.extend(new function(){this.initialize=function(){for(var b in e)e.hasOwnProperty(b)&&function(){var g=d(e[b]),h="beforeRoute",i="afterRoute";this.route(b,function(){f&&(Array.prototype.push.call(arguments,f),f=null),a.Controller&&a.Controller!=g.behalf&&a.Controller.blur(),c=g.behalf,g.behalf[h]&&g.behalf[h](),g.method.apply(g.behalf,arguments),g.behalf[i]&&g.behalf[i]()})}.bind(this)()}})),b=!0,Backbone.history.start({pushState:!0})||alert("HTTP 404: Unknown path")};var e=function(a){var b=f(a);return Boolean(b.host)},f=function(a){var b=document.createElement("a");return b.href=a,{protocol:b.protocol,host:b.host,hostname:b.hostname,port:b.port,pathname:b.pathname,hash:b.hash,search:b.search}};a.redirect=function(c,d){if(!b)throw new Error("App has not been run. Use App.run method");var g,h={trigger:!0};g=e(c)?f(c).pathname:c,a.Router.navigate(g,$.extend(h,d))}};if(use("Extensions").Youtube=new function(){var a=!1,b=function(){},c=function(){window.onYouTubeIframeAPIReady=function(){a=!0,b()}},d=function(){};Object.defineProperty(this,"onload",{get:function(){return d},set:function(c){d=c,a?d():b=function(){d()}}}),function(){c()}()},!window.YT)var YT={loading:0,loaded:0};if(!window.YTConfig)var YTConfig={host:"http://www.youtube.com"};YT.loading||(YT.loading=1,function(){var a=[];YT.ready=function(b){YT.loaded?b():a.push(b)},window.onYTReady=function(){YT.loaded=1;for(var b=0;b<a.length;b++)try{a[b]()}catch(c){}},YT.setConfig=function(a){for(var b in a)a.hasOwnProperty(b)&&(YTConfig[b]=a[b])};var b=document.createElement("script");b.id="www-widgetapi-script",b.src="https://s.ytimg.com/yts/jsbin/www-widgetapi-vfl5ruqc5/www-widgetapi.js",b.async=!0;var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}()),function(a){a.fn.reverse=[].reverse,a.fx.step.clip=function(b){if(0===b.pos){var c=/^rect\((\d+\.?\d*)(?:px|em)?,?\s+(\d+\.?\d*)(?:px|em)?,?\s+(\d+\.?\d*)(?:px|em)?,?\s+(\d+\.?\d*)(?:px|em)?\)$/,d=a(b.elem).css("clip"),e=c.exec(d);if(e){b.start=[parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseInt(e[4])];var f=c.exec(b.end);f&&(b.end=[parseInt(f[1]),parseInt(f[2]),parseInt(f[3]),parseInt(f[4])])}}if(a.isArray(b.start)&&a.isArray(b.end)){var g=Math.round((b.end[0]-b.start[0])*b.pos+b.start[0]),h=Math.round((b.end[1]-b.start[1])*b.pos+b.start[1]),i=Math.round((b.end[2]-b.start[2])*b.pos+b.start[2]),j=Math.round((b.end[3]-b.start[3])*b.pos+b.start[3]);b.elem.style.clip="rect("+g+"px, "+h+"px, "+i+"px, "+j+"px)"}}}(jQuery),function(a){a.fx.step.rotateY=function(a){if(0===a.pos){var b=/^rotateY\((\d+)deg\)$/,c=a.elem.style.webkitTransform,d=b.exec(c);d&&(a.start=parseInt(d[1]))}if(null!==a.start&&null!==a.end){var e=Math.round((a.end-a.start)*a.pos+a.start);a.elem.style.webkitTransform="rotateY("+e+"deg)"}}}(jQuery),use("Components").Container=function(){var a={};this.add=function(b,c){return a[b]=c,this},this.has=function(b){return a.hasOwnProperty(b)},this.get=function(b,c){return c=c||void 0,a[b]||c},this.clear=function(){return a={},this}},use("Components").Modal=Backbone.View.extend(function(){function a(a,b,c){var d=null;Object.defineProperty(this,"target",{get:function(){return d},set:function(a){d=$(a)[0]}});var e=null;Object.defineProperty(this,"type",{get:function(){return e},set:function(a){if(!Object.isString(a))throw new Error("Invalid property type: Event.type must be a string");e=a}});var f=function(){};Object.defineProperty(this,"handler",{get:function(){return f},set:function(a){if(!Object.isFunction(a))throw new Error("Invalid property type: Event.handler must be a function");f=a}}),this.on=function(){return this.target.addEventListener(this.type,this.handler),this},this.off=function(){return this.target.removeEventListener(this.type,this.handler),this},function(){this.target=a,this.type=b,this.handler=c}.bind(this)()}var b=[],c=!0;Object.defineProperty(this,"isHidden",{get:function(){return c}}),this.containerEl=null,this.overlayEl=null,this.windowEl=null,this.titleEl=null,this.contentEl=null,this.closeEl=null,Object.defineProperty(this,"width",{get:function(){return this.contentEl.clientWidth},set:function(a){return this.contentEl.style.width=a+"px"}}),Object.defineProperty(this,"height",{get:function(){return this.contentEl.clientHeight},set:function(a){this.contentEl.style.height=a+"px"}}),Object.defineProperty(this,"content",{get:function(){return this.contentEl},set:function(a){$(this.contentEl).html(a)}}),this.onshow=function(){},this.onhide=function(){},this.initialize=function(){j(),k()};var d=function(){var a=document.getElementById("modal");return a||(a=document.createElement("div"),a.id="modal",a.className="vertical-align absolute-size hidden",document.body.appendChild(a)),a},e=function(){var a=this.containerEl.querySelector(".overlay");return a||(a=document.createElement("div"),a.className="overlay absolute-size",this.containerEl.appendChild(a)),a}.bind(this),f=function(){var a=document.createElement("div");return a.className="window inline hidden",a},g=function(){var a=document.createElement("div");return a.className="title",a},h=function(){var a=document.createElement("div");return a.className="content",a},i=function(){var a=document.createElement("a");a.href="javascript:void(0)",a.className="close";var b=document.createElement("i");return b.className="fa fa-times",a.appendChild(b),a},j=function(){this.containerEl=d();var a=this.containerEl.querySelector(".center");a||(a=document.createElement("div"),a.className="center align-center",this.containerEl.appendChild(a)),this.overlayEl=e(),this.windowEl=f(),this.titleEl=g(),this.contentEl=h(),this.closeEl=i(),this.windowEl.appendChild(this.titleEl),this.windowEl.appendChild(this.contentEl),this.windowEl.appendChild(this.closeEl),a.appendChild(this.windowEl)}.bind(this),k=function(){b.push(new a(this.overlayEl,"click",this.hide.bind(this))),b.push(new a(this.closeEl,"click",this.hide.bind(this)));var c=this;b.push(new a(document,"keydown",function(a){27==a.which&&c.hide()}))}.bind(this);this.show=function(){if(!c)return this;this.containerEl.classList.remove("hidden"),this.windowEl.classList.remove("hidden");for(var a=0,d=b.length;d>a;a++)b[a].on();return this.onshow(),c=!1,this},this.hide=function(){if(c)return this;this.containerEl.classList.add("hidden"),this.windowEl.classList.add("hidden");for(var a=0,d=b.length;d>a;a++)b[a].off();return this.onhide(),c=!0,this}}),use("Components").Gallery=Backbone.View.extend(function(){this.modal=null,this.model=null;var a=null,b=null,c=new Components.Container,d=1,e=!1,f=null;Object.defineProperty(this,"imageEl",{get:function(){return f},set:function(a){f&&this.modal.contentEl.removeChild(f),a&&(f=a,this.modal.contentEl.appendChild(f))}}),this.prevButtonEl=null,this.nextButtonEl=null,this.sourceButtonEl=null,Object.defineProperty(this,"image",{get:function(){return this.imageEl.src},set:function(a){this.imageEl.src=a}}),Object.defineProperty(this,"source",{get:function(){return this.sourceButtonEl.href},set:function(a){this.sourceButtonEl.href=a}});var g=function(){return{minWidth:550,minHeight:550,maxWidth:window.innerWidth-100,maxHeight:window.innerHeight-100}},h=function(a,b){var c,d=g();a>d.maxWidth&&(c=d.maxWidth/a,a=d.maxWidth,b*=c),b>d.maxHeight&&(c=d.maxHeight/b,b=d.maxHeight,a*=c),this.modal.width=a,this.modal.height=b,this.modal.contentEl.style.lineHeight=b+"px"}.bind(this),i=function(){return document.createElement("img")},j=function(a){var b={prev:"prev",next:"next"},c={prev:"left",next:"right"},d=document.createElement("button");d.className="controls "+b[a];var e=document.createElement("i");return e.className="fa fa-angle-"+c[a],d.appendChild(e),d},k=function(){var a=document.createElement("a");a.href="javascript:void(0)",a.className="source",a.target="_blank";var b=document.createElement("i");return b.className="fa fa-expand",a.appendChild(b),a},l=function(){this.modal=new Components.Modal,this.imageEl=i(),this.prevButtonEl=j("prev"),this.nextButtonEl=j("next"),this.sourceButtonEl=k(),m(),this.modal.windowEl.appendChild(this.prevButtonEl),this.modal.windowEl.appendChild(this.nextButtonEl),this.modal.windowEl.appendChild(this.sourceButtonEl)}.bind(this);this.initialize=function(){l()};var m=function(){var a=this;this.prevButtonEl.addEventListener("click",function(){a.switchOver(-1)}),this.nextButtonEl.addEventListener("click",function(){a.switchOver(1)}),document.addEventListener("keydown",function(a){e||(37==a.keyCode?(this.switchOver(-1),a.preventDefault()):39==a.keyCode&&(this.switchOver(1),a.preventDefault()))}.bind(this)),window.addEventListener("resize",function(){h(this.width,this.height)}.bind(this))}.bind(this),n=function(){if(this.model){var e=this.model.get("id");if(e){var f=1==d?"next":"prev",g=c.get(e),h=g[f];void 0!==h?b=new Core.Promise(function(b){a=h,b()}):(a=new Models.Media,b=a.fetch({url:Core.createAbsoluteUrl("/media/"+e+"/"+f)}),b.then(function(){if(a.isEmpty())a=null,g[f]=!1;else{g[f]=a;var b=a.attributes,c=new Image;b.bigThumb.url&&(c.src=b.bigThumb.url,a.bigThumbLoaded=!1,c.onload=function(){a.bigThumbLoaded=!0})}},function(){a=null,g[f]=!1}))}}}.bind(this),o=function(a){this.model=a,q(a)}.bind(this),p=function(a,b,d){var e=a.get("id");c.has(e)||c.add(e,{prev:void 0,model:a,next:void 0});var f=c.get(e);b&&(f.prev=b),d&&(f.next=d)},q=function(a){var b=a.attributes;b&&(this.width=b.bigThumb.width,this.height=b.bigThumb.height,h(b.bigThumb.width,b.bigThumb.height),a.bigThumbLoaded===!1&&(this.imageEl=i()),this.image=b.bigThumb.url,this.source=b.source.url)}.bind(this),r=function(){e=!1,this.prevButtonEl.removeAttribute("disabled"),this.nextButtonEl.removeAttribute("disabled")}.bind(this),s=function(){e=!0,this.prevButtonEl.setAttribute("disabled","disabled"),this.nextButtonEl.setAttribute("disabled","disabled")}.bind(this);this.show=function(a){return o(a),p(a),n(),r(),this.modal.show(),this},this.hide=function(){return this.modal.hide(),this.imageEl=i(),s(),this},this.switchOver=function(c){var e;if("next"===c||1===c)e=1;else{if("prev"!==c&&-1!==c)throw new Error("Invalid argument value: invalid [direction] value");e=-1}return d!==e&&(d=e,n()),s(),b.then(function(){if(r(),!a)return void this.hide();var b=this.model;o(a);var c=[a];1===e?c.push(b):(c.push(null),c.push(b)),p.apply(null,c),n()}.bind(this),function(){alert("error occurred"),this.hide()}.bind(this)),this},this.clearState=function(){return this.model=null,a=null,b=null,c.clear(),d=1,e=!1,this}}),use("Components").Player=Backbone.View.extend(function(){var a="player",b=null,c=null;this.modal=null;var d=!1,e=function(){this.modal=new Components.Modal,this.modal.width=window.innerWidth-300,this.modal.height=window.innerHeight-100,this.modal.content='<div id="'+a+'"></div>',this.modal.onhide=function(){b&&b.stopVideo?b.stopVideo():d=!0}}.bind(this),f=function(){if(!this.modal)throw new Error("Cant create YT player instance. Modal window instance should be created first");c=new Core.Promise(function(c){b=new YT.Player(a,{width:this.modal.width,height:this.modal.height,events:{onReady:function(){c()}}})}.bind(this))}.bind(this);this.initialize=function(){e(),Extensions.Youtube.onload=f},this.play=function(a){return c.then(function(){d||b.loadVideoById(a)}),this.modal.show(),d=!1,this}}),use("Models").Facade=Core.Model.extend(function(){this.url=function(){return Core.createAbsoluteUrl(location.pathname)},this.parse=function(a){return a.success}}),use("Models").Media=Core.Model.extend(function(){this.parse=function(a){return a.success}}),use("Collections").ArtCollection=Core.Collection.extend(function(){this.model=Models.Media,this.url=function(){return Core.createAbsoluteUrl(location.pathname)},this.total=0,this.init=function(a){return this.total=a.total,this.set(a.data)},this.parse=function(a){return this.total=a.success.total,a.success.data}}),use("Collections").Art3d=Collections.ArtCollection.extend(),use("Collections").Pictures2d=Collections.ArtCollection.extend(),use("Collections").Videos=Collections.ArtCollection.extend(),use("Controllers").App=Core.Controller.extend(new function(){this.captureRedirect=function(a){a&&a.currentTarget.href&&(a.preventDefault(),App.redirect(a.currentTarget.href))}}),use("Controllers").Art=Core.Controller.extend(new function(){var a=!1,b=null,c="",d=null,e=null,f=function(a){a!=c&&(c=a,g())},g=function(){b=null,a=!1,d&&d.clearState()},h=function(c,d,e,f,g){var h,i,j=new c;e&&j.init(e),j.fetch().then(function(){var c={collection:j};a&&(c.rollDown=!1),h=new d(c),i=new Views.Art.AsideCollection({collection:j}),Views.Layouts.TopNav.render().toTopLayer()[f]().PictureNavRegion.empty();var e=Views.Layouts.Art;e.render(),e.ThumbsRegion.display(h),e.setAsideCaption(g),e.AsideRegion.display(i),b||(b=new Views.Art.Pagination({total:j.total}),e.PaginationRegion.display(b)),a=!0})}.bind(this);this.animations=function(a,b,c){f("animations"),h(Collections.Videos,Views.Art.VideosCollection,c,"highlightAnimationsCaption","Animations")},this.pictures2d=function(a,b,c){f("pictures2d"),h(Collections.Pictures2d,Views.Art.PicturesCollection,c,"highlightPictures2dCaption","Pictures 2d")},this.art3d=function(a,b,c){f("art3d"),h(Collections.Art3d,Views.Art.PicturesCollection,c,"highlightArt3dCaption","Art 3d")},this.blur=function(){g()},this.modal=function(a,b){d||(d=new Components.Gallery),d.show(b.model)},this.play=function(a,b){e||(e=new Components.Player),e.play(b.model.get("ytId"))}}),use("Controllers").Main=Core.Controller.extend(new function(){this.index=function(a,b){var c,d=new Models.Facade;b&&d.set(b),d.fetch().then(function(){c=new Views.Main.Index({model:d}),Views.Layouts.Main.render().BodyRegion.empty(),Views.Layouts.TopNav.render().reset().PictureNavRegion.display(c)})}}),use("Views.Art").Thumb=Core.View.extend(function(){var a=300,b=1e3;this.attributes={"class":"button thumb"},this.events={mouseenter:"triggerEnterState",mouseleave:"triggerLeaveState"},this.imageEl=null,this.$imageEl=null,this.initialize=function(){this.render(),this.onclick&&(this.events.click=this.onclick,this.delegateEvents()),this.listenTo(this.model,"aside.enter",this.toggleHighlight),this.listenTo(this.model,"aside.leave",this.toggleHighlight),this.listenTo(this.model,"aside.click",function(){this.$el.click()})};var c=function(){var a=.15,b=Math.floor(window.innerWidth*a),c=.7,d=Math.floor(b*c);return{width:b,height:d}},d=function(){return Math.random()*(b-a)+a};this.render=function(){if(!this.model)return this;this.adjustSize(),this.imageEl=document.createElement("div"),this.imageEl.classList.add("image"),this.imageEl.innerHTML='<img src="'+this.model.get("smallThumb").url+'" />',this.$imageEl=$(this.imageEl),this.el.appendChild(this.imageEl);var a=this;return window.addEventListener("resize",function(){a.adjustSize()}),this},this.adjustSize=function(){var a=c();return this.el.style.width=a.width+"px",this.el.style.height=a.height+"px",this},this.rollDown=function(){return this.$imageEl?(this.$imageEl.animate({height:"100%"},{duration:d(),complete:function(){this.classList.add("animated")}}),this):this},this.show=function(){return this.imageEl?(this.imageEl.classList.add("animated"),this):void 0},this.toggleHighlight=function(){if(this.el){var a=this.el.classList.contains("hover")?"remove":"add";this.el.classList[a]("hover")}},this.triggerEnterState=function(){this.model.trigger("preview.enter")},this.triggerLeaveState=function(){this.model.trigger("preview.leave")}}),use("Views.Art").ThumbsCollection=Core.ViewCollection.extend(function(){var a=this;this.rollDown=!0,this.initialize=function(b){a.__super__.initialize.apply(this,arguments),b.hasOwnProperty("rollDown")&&(this.rollDown=b.rollDown)},this.display=function(a){for(var b,c=0,d=this.Views.length;d>c;c++)b=this.Views[c],a.append(b),this.rollDown?b.rollDown():b.show();return this}}),use("Views.Art").Aside=Core.View.extend(function(){this.tagName="li",this.events={click:"triggerClickState",mouseenter:"triggerEnterState",mouseleave:"triggerLeaveState"},this.linkEl=null,this.initialize=function(){this.listenTo(this.model,"preview.enter",this.toggleHighlight),this.listenTo(this.model,"preview.leave",this.toggleHighlight),this.render()},this.render=function(){return this.model?(this.linkEl=document.createElement("a"),this.linkEl.href="javascript:void(0)",this.linkEl.title=this.model.get("title"),this.linkEl.textContent=this.model.get("title"),this.el.appendChild(this.linkEl),this):this},this.triggerClickState=function(){this.model.trigger("aside.click")},this.toggleHighlight=function(){if(this.linkEl){var a=this.linkEl.classList.contains("hover")?"remove":"add";this.linkEl.classList[a]("hover")}},this.triggerEnterState=function(){this.model.trigger("aside.enter")},this.triggerLeaveState=function(){this.model.trigger("aside.leave")}}),use("Views.Art").AsideCollection=Core.ViewCollection.extend(function(){this.view=Views.Art.Aside,this.display=function(a){for(var b=0,c=this.Views.length;c>b;b++)a.append(this.Views[b]);return this}}),use("Views.Art").Pagination=Core.View.extend(function(){var a=4,b=0;Object.defineProperty(this,"total",{get:function(){return b},set:function(a){b=a,this.pagesNumber=Math.ceil(a/this.perPage)}});var c=0;Object.defineProperty(this,"pagesNumber",{get:function(){return c},set:function(a){c=a}}),this.perPage=9;var d=null;Object.defineProperty(this,"listEl",{get:function(){return d},set:function(a){d=a,this.$listEl=$(a)}});var e=null;Object.defineProperty(this,"loaderEl",{get:function(){return e},set:function(a){e=a,this.$loaderEl=$(a)}});var f=null;Object.defineProperty(this,"activePageEl",{get:function(){return f},set:function(a){f=a,this.$activePageEl=$(a)}}),this.tagName="ul",this.attributes={"class":"float-left"},this.events={"click a":function(a){this.activePageEl&&this.activePageEl.classList.remove("active"),this.activePageEl=a.currentTarget.parentNode,this.activePageEl.classList.add("active"),h(),Controllers.App.captureRedirect(a)}},this.initialize=function(a){this.total=a.total||0,this.render()};var g=function(){var a=null,b=null,c=j(location.pathname);if(!(this.pagesNumber<=1)){for(var d=1;d<=this.pagesNumber;d++)a=document.createElement("li"),a.className="page",d==c.pageId&&(a.classList.add("active"),this.activePageEl=a),b=document.createElement("a"),b.href=location.origin+c.origin+"/"+d,b.textContent=d,a.appendChild(b),this.el.appendChild(a);h()}},h=function(){if(this.pagesNumber!=a){var b,c,d,e=this.$activePageEl.index()+1,f=e-1,g="";for(1>f&&(f=1),d=f-1+a,c=d,b=f;d>=b;b++)b>this.pagesNumber&&(f--,c--);for(b=f;c>=b;b++)g+=":not(:nth-child("+b+"))";this.$el.children().removeClass("hidden").removeClass("last"),this.$el.children(g).addClass("hidden"),this.$el.children(":not(.hidden):last").addClass("last")}}.bind(this),i=function(){this.loaderEl=document.createElement("div"),this.loaderEl.className="float-left loader hidden",this.loaderEl.textContent="Loading..."}.bind(this),j=function(a){var b=a.match(/^(\/art\/(?:animations|2d|3d))(?:\/(\d+))?$/)||[];return{origin:b[1]||"",pageId:b[2]||1}};this.render=function(){return g.bind(this)(),i(),this},this.display=function(a){return a.el.appendChild(this.loaderEl),a.el.appendChild(this.el),this}}),use("Views.Art").Picture=Views.Art.Thumb.extend(function(){this.onclick=Controllers.Art.modal}),use("Views.Art").PicturesCollection=Views.Art.ThumbsCollection.extend(function(){this.view=Views.Art.Picture}),use("Views.Art").Video=Views.Art.Thumb.extend(function(){this.onclick=Controllers.Art.play}),use("Views.Art").VideosCollection=Views.Art.ThumbsCollection.extend(function(){this.view=Views.Art.Video}),use("Views.Layouts").Art=Core.ViewLayout.extend(function(){this.thumbsEl=null,this.asideEl=null;var a=null,b=function(){var a=document.createElement("div");a.className="art-medium-preview clearfix";
var b=document.createElement("div");b.className="art-medium",b.appendChild(a);var c=document.createElement("div");c.className="inline",c.appendChild(b);var d=document.createElement("div");d.className="center",d.appendChild(c);var e=document.createElement("div");return e.id="art",e.className="absolute-size vertical-align",e.appendChild(d),{structureEl:e,mediumEl:b,previewEl:a}},c=function(){var a=document.createElement("div");a.className="caption";var b=document.createElement("ul");b.className="align-left";var c=document.createElement("div");c.className="center align-left",c.appendChild(a),c.appendChild(b);var d=document.createElement("aside");return d.id="asideNavMenu",d.className="absolute-height vertical-align",d.appendChild(c),{structureEl:d,captionEl:a,listEl:b}},d=function(){var a=document.createElement("div");return a.className="pagination",a};this.render=function(){return this.rendered?this:(Views.Layouts.Main.render().BodyRegion.display(this),this.rendered=!0,this)},this.display=function(e){var f=b();e.el.appendChild(f.structureEl),this.thumbsEl=f.structureEl;var g=c();e.el.appendChild(g.structureEl),a=g.captionEl,this.asideEl=g.structureEl;var h=d();f.mediumEl.appendChild(h),this.ThumbsRegion=new Core.Region(f.previewEl),this.AsideRegion=new Core.Region(g.listEl),this.PaginationRegion=new Core.Region(h)},this.remove=function(){return this.thumbsEl.parentNode.removeChild(this.thumbsEl),this.asideEl.parentNode.removeChild(this.asideEl),this.rendered=!1,this},this.setAsideCaption=function(b){return a.textContent=b,this}}),use("Views.Layouts").Main=Core.ViewLayout.extend(function(){this.events={"click #logo":Controllers.App.captureRedirect},this.bodyEl=null,this.substrateEl=null,this.logoEl=null,this.render=function(){return this.rendered?this:(this.setElement(document.body),a(),b(),c(),d(),this.BodyRegion=new Core.Region(this.bodyEl),this.rendered=!0,this)};var a=function(){var a=document.createElement("div");a.id="body",this.bodyEl=a,this.el.appendChild(this.bodyEl)}.bind(this),b=function(){var a=document.createElement("div");a.id="substrate",a.style.height=window.innerWidth/2+"px",window.addEventListener("resize",function(){a.style.height=window.innerWidth/2+"px"}),this.substrateEl=a,this.el.appendChild(this.substrateEl)}.bind(this),c=function(){var a=document.createElement("a");a.id="logo",a.href=Core.createAbsoluteUrl("/");var b=document.createElement("img");b.src=Core.createAbsoluteUrl("/img/logo.png"),a.appendChild(b),this.logoEl=a,this.el.appendChild(this.logoEl)}.bind(this),d=function(){var a=new Views.Components.Contacts;a.render(),this.el.appendChild(a.el)}.bind(this)}),use("Views.Layouts").TopNav=Core.ViewLayout.extend(function(){this.tagName="nav",this.attributes={id:"topNavMenu"},this.events={"click .caption":Controllers.App.captureRedirect},this.initialize=function(){this.PictureNavRegion=new Core.Region(this.el)};var a=null,b=null,c=null,d=null,e=800,f=function(){var a=document.createElement("ul"),e=function(a,b){var c=document.createElement("li"),d=document.createElement("a");return c.className="float-left",d.className="caption smooth",d.href=a,d.textContent=b,c.appendChild(d),c};return b=e(Core.createAbsoluteUrl("/art/animations"),"Animations"),c=e(Core.createAbsoluteUrl("/art/2d"),"Pictures 2d"),d=e(Core.createAbsoluteUrl("/art/3d"),"Art 3d"),a.appendChild(b),a.appendChild(c),a.appendChild(d),a}.bind(this);this.render=function(){return this.rendered?this:(Views.Layouts.Main.render(),this.el.appendChild(f()),Views.Layouts.Main.bodyEl.appendChild(this.el),this.rendered=!0,this)},this.display=function(){return new Core.Promise(function(a){this.$el.fadeTo(e,1,a)}.bind(this))},this.toTopLayer=function(){return this.el.classList.add("absolute"),this},this.reset=function(){return this.el.classList.remove("absolute"),h(),this};var g=function(b){b&&(h(),a=b,b.firstChild.classList.add("active"))},h=function(){a&&a.firstChild.classList.remove("active")};this.highlightAnimationsCaption=function(){return g(b),this},this.highlightPictures2dCaption=function(){return g(c),this},this.highlightArt3dCaption=function(){return g(d),this}}),use("Views.Components").Contacts=Core.View.extend(function(){var a=100;this.captionEl=null;var b=null;Object.defineProperty(this,"listEl",{get:function(){return b},set:function(a){b=a,this.$listEl=$(a)}});var c=!0;this.attributes={"class":"contacts"},this.events={"click .contacts__caption":"slideToggle"},this.slideUp=function(){return this.$listEl.slideUp(a),c=!0,this},this.slideDown=function(){return this.$listEl.slideDown(a),c=!1,this},this.slideToggle=function(){return c?this.slideDown():this.slideUp(),this},this.render=function(){var a=document.createElement("div");a.className="contacts__caption",this.captionEl=d(),a.appendChild(this.captionEl),this.el.appendChild(a);var b=document.createElement("div");b.className="contacts__list",this.listEl=e(),b.appendChild(this.listEl),this.el.appendChild(b),f()};var d=function(){var a=document.createElement("button");a.className="contacts-caption",a.textContent="Contacts";var b=document.createElement("i");return b.className="fa fa-caret-down",a.appendChild(b),a},e=function(){var a=document.createElement("ul"),b=document.createElement("li"),c=document.createElement("li");return a.className="contacts-list",a.style.display="none",b.className="contacts-list__contact",b.textContent="Skype: DDDimaXXX",a.appendChild(b),c.className="contacts-list__contact",c.textContent="E-mail: chpsemenov@yandex.ru",a.appendChild(c),a},f=function(){var a=this;document.body.addEventListener("click",function(b){var d=$(b.target);c||d==a.$el||d.parents(".contacts").size()||a.slideUp()})}.bind(this)}),use("Views.Main").Index=Core.View.extend(function(){function a(b){var c=this,d=700,e=1e3,f=1200,g=1700,h=10,i=null,j=null,k={},l=!1;Object.defineProperty(c,"position",{get:function(){return k}}),c.set=function(a){var b=$(a)[0];if(!b)throw new Error("Invalid argument type: element must be an existing HTMLElement");if(!b.classList.contains("nav-menu-item-pic"))throw new Error("Invalid argument type: element must be an folding html element");return i=b,j=$(i),m(),c};var m=function(){var b=j.parent(),c=j.siblings().size()+1,d=b.width()/c,e=b.width(),f=0,g=window.innerHeight-b.offset().top,h=function(a,b,c,d,e,f){return{width:a||0,height:b||0,clip:{y1:c||0,x1:d||0,y2:e||0,x2:f||0}}},i=h(d,f,0,d*(j.index()+1),g,d*j.index());k={start:i,end:h(e,g,0,e,g,0),dropDuration:o()},j.data("position",k),j.css("clip",a.clipToString(i.clip.y1,i.clip.x1,i.clip.y2,i.clip.x2))},n=function(){l||(i.addEventListener("mouseenter",c.toFullWidth),i.addEventListener("mouseleave",c.toDefaultWidth),l=!0)};c.toFullHeight=function(){return new Core.Promise(function(a){j.animate({height:c.position.end.height},{duration:c.position.dropDuration,complete:function(){n(),a()}})})},c.toFullWidth=function(){q();var b=p(),d=0;j.prevAll().reverse().each(function(c){var e=$(this),f=e.data("position"),g=h*(c+1),i=h*c;d+=g-i,a.animate(e,b,f.start.clip.y1,g,f.start.clip.y2,i)});var e=0;return j.nextAll().reverse().each(function(c){var d=$(this),f=d.data("position"),g=f.start.clip.x1+(f.start.width-h)*c,i=f.start.clip.x2+(f.start.width-h)*(c+1);e+=g-i,a.animate(d,b,f.start.clip.y1,g,f.start.clip.y2,i)}),a.animate(j,b,c.position.start.clip.y1,c.position.end.clip.x1-e,c.position.start.clip.y2,c.position.end.clip.x2+d),c},c.toDefaultWidth=function(){q();var b=p(),d=j.siblings();return d.push(j[0]),$.each(d,function(c,d){var e=$(d),f=e.data("position");a.animate(e,b,f.start.clip.y1,f.start.clip.x1,f.start.clip.y2,f.start.clip.x2)}),c};var o=function(){return Math.floor(Math.random()*(e-d)+d)},p=function(){return Math.floor(Math.random()*(g-f)+f)},q=function(){var a=j.parent();a.children().stop(!0)};!function(a){c.set(a)}(b)}var b,c,d,e=[],f=function(a){return a.parentNode.querySelector(".caption")},g=function(a){f(a.currentTarget).classList.toggle("active")};this.events={"mouseenter .nav-menu-item-pic-container":g,"mouseleave .nav-menu-item-pic-container":g,"click .nav-menu-item-pic-container":Controllers.App.captureRedirect},this.display=function(a){return this.setElement(a.el),b=i(this.model.get("animations"),"/art/animations"),c=i(this.model.get("pictures2d"),"/art/2d"),d=i(this.model.get("art3d"),"/art/3d"),a.el.querySelector("li:nth-child(1)").appendChild(b),a.el.querySelector("li:nth-child(2)").appendChild(c),a.el.querySelector("li:nth-child(3)").appendChild(d),j(),k(),this};var h=function(a){return a instanceof HTMLElement};this.remove=function(){return h(b)&&b.parentNode.removeChild(b),h(c)&&c.parentNode.removeChild(c),h(d)&&d.parentNode.removeChild(d),this.undelegateEvents(),this};var i=function(a,b){var c,d=document.createElement("a");d.classList.add("nav-menu-item-pic-container"),d.href=b;for(var e=0,f=a.length;f>e;e++)c=document.createElement("div"),c.classList.add("nav-menu-item-pic"),c.style.backgroundImage="url("+a[e].cover.url+")",d.appendChild(c);return d},j=function(){for(var b=document.querySelectorAll(".nav-menu-item-pic"),c=0,d=b.length;d>c;c++)e.push(new a(b[c]))},k=function(){for(var a=0,b=e.length;b>a;a++)e[a].toFullHeight().then(function(){})};a.clipToString=function(a,b,c,d){return"rect("+a+"px, "+b+"px, "+c+"px, "+d+"px)"},a.animate=function(b,c,d,e,f,g){$(b).animate({clip:a.clipToString(d,e,f,g)},{duration:c,easing:"linear"})}}),$(document).ready(function(){var a=document.body.textContent.trim(),b=null;a.length&&(b=JSON.parse(a)),document.body.textContent="";var c={"":"Controllers.Main.index","art/animations(/:page)":"Controllers.Art.animations","art/2d(/:page)":"Controllers.Art.pictures2d","art/3d(/:page)":"Controllers.Art.art3d"};App.run(c,b)});